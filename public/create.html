<!DOCTYPE HTML>
<html>
<head>
  <meta charset="UTF-8">
  <title>Main</title>
  <script src="client.js"></script>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
  <link rel="stylesheet" href="style.css">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
</head>

<body>

<div class="container">
  <div class="row">
    <div class="col-sm-12">
      <nav class="navbar navbar-light bg-white mb-2">
        <span class="navbar-brand mb-0 h1">YT Notes</span>
      </nav>
    </div>
  </div>
  <div class="row">
    <div class="col-md-8">
      <div id="player"></div>
    </div>
    <div class="col-md-4">
      <div class="card" style="height:360px;">
        <div class="card-body overflow-auto">
          <h5 class="card-title">FAQ</h5>
          <b>What is YT Notes?</b>
          <p>YT Notes is a web app where you can add timestamp-tied notes to a YouTube video</p>
          <b>Where can I get the Video ID?</b>
          <p>On the YouTube page of your video, click “Share”. There will be a pop up with a link like so (https://youtu.be/gCKE-tuMies). Your video id is whatever is after the /, in this case it’s gCKE-tuMies.</p>
          <b>I can’t seem to click the add note button, what should I do?</b>
          <p>There can only be one note per-timestamp. Check if you’ve already created a note for that timestamp by scrolling down. To add a note on other timestamp, play the video to the point where you want to add the note and press “Add note” at that time.</p>
          <b>What formatting does youtube-notes use?</b>
          <p>Youtube-notes uses Markdown to format its notes. For more info on Markdown syntax you can visit https://daringfireball.net/projects/markdown/syntax</p>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-md-12">
      <pre id="elm"></pre>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12 text-center">
      <span>© 2020 by </span><a href="https://tadityar.me">tadityar</a><span> - </span><a href="https://github.com/tadityar/youtube-notes">source code</a>
    </div>
  </div>
</div>
<script>
// load YT iframe js
var tag = document.createElement('script');

tag.src = "https://www.youtube.com/iframe_api";
var firstScriptTag = document.getElementsByTagName('script')[0];
firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

const queryString = window.location.search;
const urlParams = new URLSearchParams(queryString);
const hasVideoId = urlParams.get('videoId');

var videoId;
if (hasVideoId) {
  videoId = urlParams.get('videoId');
} else {
  videoId = "";
}
var player;
function onYouTubeIframeAPIReady() {
  player = new YT.Player('player', {
    videoId: videoId,
    events: {
      'onReady': onPlayerReady,
    }
  });
}

// elm-stuff
var flags = {
  currentTime: 0,
  videoId: videoId,
}
var app = Elm.Create.init({
  node: document.getElementById('elm'),
  flags: flags
});
app.ports.seekVideo.subscribe(function(timeStamp) {
  player.seekTo(Number(timeStamp));
});

ready = false;
function onPlayerReady(event) {
  ready = true;
  setInterval(getTimestamp, 500, app, ready)
}

function getTimestamp(app, ready) {
  if (ready) {
    console.log({ currentTime: player.getCurrentTime()})
      app.ports.getTimestamp.send(player.getCurrentTime())
  }
}

</script>

</body>
</html>
